{% extends 'base.html.twig' %}

{% block title %}Activity Logs{% endblock %}

{% block stylesheets %}
{{ parent() }}
<style>
    .page-header-section {
        background: white;
        border: 1px solid #e9ecef;
        border-radius: 8px;
        padding: 1.5rem;
        margin-bottom: 1.5rem;
    }
    
    .page-header-section h1 {
        color: #198754;
        font-weight: 600;
        font-size: 1.5rem;
        margin: 0;
    }
    
    .filter-section {
        background: white;
        border: 1px solid #e9ecef;
        border-radius: 8px;
        padding: 1.5rem;
        margin-bottom: 1.5rem;
    }
    
    .filter-label {
        color: #6c757d;
        font-size: 0.75rem;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        margin-bottom: 0.5rem;
        font-weight: 600;
    }
    
    .form-control, .form-select {
        border: 1px solid #e9ecef;
        border-radius: 6px;
        padding: 0.75rem;
        transition: all 0.2s;
    }
    
    .form-control:focus, .form-select:focus {
        border-color: #198754;
        box-shadow: 0 0 0 0.2rem rgba(25, 135, 84, 0.1);
    }
    
    .btn-filter {
        background: #198754;
        border: 1px solid #198754;
        color: white;
        padding: 0.75rem;
        border-radius: 6px;
        font-weight: 500;
        transition: all 0.2s;
    }
    
    .btn-filter:hover {
        background: #157347;
        border-color: #157347;
        color: white;
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(25, 135, 84, 0.2);
    }
    
    .logs-table-container {
        background: white;
        border: 1px solid #e9ecef;
        border-radius: 8px;
        overflow: hidden;
        margin-bottom: 1.5rem;
    }
    
    .logs-table {
        margin: 0;
    }
    
    .logs-table thead th {
        background: #f8f9fa;
        color: #6c757d;
        font-size: 0.875rem;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        font-weight: 600;
        border-bottom: 2px solid #e9ecef;
        padding: 1rem;
    }
    
    .logs-table tbody td {
        padding: 1rem;
        color: #212529;
        vertical-align: middle;
    }
    
    .logs-table tbody tr {
        border-bottom: 1px solid #e9ecef;
        transition: background-color 0.2s;
    }
    
    .logs-table tbody tr:hover {
        background-color: #f8f9fa;
    }
    
    .logs-table tbody tr:last-child {
        border-bottom: none;
    }
    
    .action-badge {
        padding: 0.35rem 0.75rem;
        border-radius: 20px;
        font-size: 0.75rem;
        font-weight: 600;
    }
    
    .action-create {
        background: #d1e7dd;
        color: #0a3622;
    }
    
    .action-update {
        background: #cfe2ff;
        color: #052c65;
    }
    
    .action-delete {
        background: #f8d7da;
        color: #58151c;
    }
    
    .action-login {
        background: #d3f9d8;
        color: #0a3622;
    }
    
    .action-logout {
        background: #e9ecef;
        color: #495057;
    }
    
    .btn-view {
        background: white;
        border: 1px solid #e9ecef;
        color: #6c757d;
        padding: 0.375rem 0.75rem;
        border-radius: 6px;
        font-size: 0.875rem;
        transition: all 0.2s;
        text-decoration: none;
    }
    
    .btn-view:hover {
        border-color: #198754;
        color: #198754;
        background: #f8f9fa;
    }
    
    .empty-state {
        padding: 3rem 2rem;
        text-align: center;
        color: #6c757d;
    }
    
    .pagination-container {
        background: white;
        border: 1px solid #e9ecef;
        border-radius: 8px;
        padding: 1.5rem;
    }
    
    .pagination {
        margin: 0;
        justify-content: center;
    }
    
    .pagination .page-link {
        color: #6c757d;
        border: 1px solid #e9ecef;
        padding: 0.5rem 0.75rem;
        margin: 0 0.25rem;
        border-radius: 6px;
        transition: all 0.2s;
    }
    
    .pagination .page-link:hover {
        background: #f8f9fa;
        border-color: #198754;
        color: #198754;
    }
    
    .pagination .page-item.active .page-link {
        background: #198754;
        border-color: #198754;
        color: white;
    }
    
    .log-id {
        color: #6c757d;
        font-weight: 600;
        font-size: 0.875rem;
    }
    
    .log-username {
        font-weight: 500;
    }
    
    .log-ip {
        font-family: 'Courier New', monospace;
        font-size: 0.875rem;
        color: #6c757d;
    }
    
    .log-date {
        font-size: 0.875rem;
        color: #6c757d;
    }
</style>
{% endblock %}

{% block admin_page_title %}Activity Logs{% endblock %}

{% block admin_content %}
{# Filters #}
<div class="filter-section">
    <form method="get" class="row g-3">
        <div class="col-md-3">
            <div class="filter-label">Username</div>
            <input type="text" name="user" value="{{ app.request.get('user') }}"
                   class="form-control" placeholder="Filter by username">
        </div>

        <div class="col-md-3">
            <div class="filter-label">Action Type</div>
            <select name="action" class="form-select">
                <option value="">All Actions</option>
                {% for option in ['Create', 'Update', 'Delete', 'Login', 'Logout'] %}
                    <option value="{{ option }}" 
                        {{ app.request.get('action') == option ? 'selected' : '' }}>
                        {{ option }}
                    </option>
                {% endfor %}
            </select>
        </div>

        <div class="col-md-3">
            <div class="filter-label">Date</div>
            <input type="date" name="date" value="{{ app.request.get('date') }}"
                   class="form-control">
        </div>

        <div class="col-md-3">
            <div class="filter-label">&nbsp;</div>
            <button class="btn btn-filter w-100" type="submit">
                <i class="fas fa-filter"></i> Apply Filters
            </button>
        </div>
    </form>
</div>

{# Logs Table #}
<div class="logs-table-container">
    <table class="table logs-table">
        <thead>
            <tr>
                <th>User</th>
                <th>Action</th>
                <th>Target</th>
                <th>IP Address</th>
                <th>Date & Time</th>
            </tr>
        </thead>
        <tbody>
        {% for log in logs %}
            <tr>
                <td class="log-username">{{ log.username ?? 'N/A' }}</td>
                <td>
                    <span class="action-badge action-{{ log.action|lower }}">
                        {{ log.action }}
                    </span>
                </td>
                <td>{{ log.targetData }}</td>
                <td class="log-ip">{{ log.ipAddress }}</td>
                <td class="log-date">{{ log.createdAt|date('M d, Y h:i A') }}</td>
            </tr>
        {% else %}
            <tr>
                <td colspan="7" class="empty-state">
                    <i class="fas fa-clipboard-list" style="font-size: 3rem; color: #e9ecef; margin-bottom: 1rem;"></i>
                    <div>No activity logs found</div>
                </td>
            </tr>
        {% endfor %}
        </tbody>
    </table>
</div>

{# Pagination #}
{% if pageCount > 1 %}
    <div class="pagination-container">
        <nav aria-label="Page navigation">
            <ul class="pagination">
                {% if currentPage > 1 %}
                    <li class="page-item">
                        <a class="page-link" href="?page={{ currentPage - 1 }}{{ app.request.get('user') ? '&user=' ~ app.request.get('user') : '' }}{{ app.request.get('action') ? '&action=' ~ app.request.get('action') : '' }}{{ app.request.get('date') ? '&date=' ~ app.request.get('date') : '' }}">
                            <i class="fas fa-chevron-left"></i>
                        </a>
                    </li>
                {% endif %}
                
                {% for i in 1..pageCount %}
                    <li class="page-item {{ i == currentPage ? 'active' : '' }}">
                        <a class="page-link" href="?page={{ i }}{{ app.request.get('user') ? '&user=' ~ app.request.get('user') : '' }}{{ app.request.get('action') ? '&action=' ~ app.request.get('action') : '' }}{{ app.request.get('date') ? '&date=' ~ app.request.get('date') : '' }}">{{ i }}</a>
                    </li>
                {% endfor %}
                
                {% if currentPage < pageCount %}
                    <li class="page-item">
                        <a class="page-link" href="?page={{ currentPage + 1 }}{{ app.request.get('user') ? '&user=' ~ app.request.get('user') : '' }}{{ app.request.get('action') ? '&action=' ~ app.request.get('action') : '' }}{{ app.request.get('date') ? '&date=' ~ app.request.get('date') : '' }}">
                            <i class="fas fa-chevron-right"></i>
                        </a>
                    </li>
                {% endif %}
            </ul>
        </nav>
    </div>
{% endif %}
{% endblock %}