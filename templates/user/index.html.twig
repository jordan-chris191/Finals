{% extends 'base.html.twig' %}

{% block title %}User Management{% endblock %}

{% block admin_page_title %}User Management{% endblock %}

{% block admin_content %}

<div class="search-filter-section">
    <form method="get" action="{{ path('app_user_index') }}">
        <div class="d-flex align-items-center gap-2 flex-wrap">

            <div class="search-box flex-grow-1" style="min-width: 250px;">
                <i class="fas fa-search"></i>
                <input type="text"
                       name="search"
                       class="form-control"
                       placeholder="Search by name, username, or email..."
                       value="{{ app.request.get('search') }}">
            </div>

            <select name="role" class="filter-select" style="min-width:150px;">
                <option value="">All Roles</option>
                <option value="ROLE_USER" {% if app.request.get('role') == 'ROLE_USER' %}selected{% endif %}>User</option>
                <option value="ROLE_STAFF" {% if app.request.get('role') == 'ROLE_STAFF' %}selected{% endif %}>Staff</option>
                <option value="ROLE_ADMIN" {% if app.request.get('role') == 'ROLE_ADMIN' %}selected{% endif %}>Admin</option>
            </select>

            <select name="status" class="filter-select" style="min-width:150px;">
                <option value="">All Status</option>
                <option value="active" {% if app.request.get('status') == 'active' %}selected{% endif %}>Active</option>
                <option value="inactive" {% if app.request.get('status') == 'inactive' %}selected{% endif %}>Inactive</option>
            </select>

            <button type="submit" class="btn btn-create">
                <i class="fas fa-filter"></i> Apply Filters
            </button>

            <a class="btn btn-create" href="{{ path('app_user_new') }}">
                <i class="fas fa-plus"></i> Create User
            </a>
        </div>
    </form>
</div>

<div class="table-container">
    <table id="userTable" class="table">
        <thead>
            <tr>
                <th>Id</th>
                <th>Username</th>
                <th>Email</th>
                <th>Roles</th>
                <th>Name</th>
                <th>Created</th>
                <th>Status</th>
                <th class="text-center">Actions</th>
            </tr>
        </thead>

        <tbody>
            {% for user in users %}
                <tr>
                    <td>{{ user.id }}</td>
                    <td>{{ user.username }}</td>
                    <td>{{ user.email }}</td>
                    <td><span class="badge badge-role">{{ user.roles|json_encode }}</span></td>
                    <td>{{ user.name }}</td>
                    <td>{{ user.createdAt ? user.createdAt|date('Y-m-d H:i') : '' }}</td>
                    <td>
                        {% if user.isActive %}
                            <span class="badge badge-active">Active</span>
                        {% else %}
                            <span class="badge badge-inactive">Inactive</span>
                        {% endif %}
                    </td>
                    <td class="text-center">
                        <a class="btn btn-action btn-view" href="{{ path('app_user_show', {'id': user.id}) }}">
                            <i class="fas fa-eye"></i>
                        </a>
                        <a class="btn btn-action btn-edit" href="{{ path('app_user_edit', {'id': user.id}) }}">
                            <i class="fas fa-edit"></i>
                        </a>
                    </td>
                </tr>
            {% else %}
                <tr>
                    <td colspan="8" class="empty-state">
                        No records found
                    </td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<script>
    $(document).ready(function () {
        $('#userTable').DataTable({
            searching: false,
            pageLength: 10,
            lengthMenu: [5, 10, 25, 50, 100]
        });
    });
</script>

{% endblock %}